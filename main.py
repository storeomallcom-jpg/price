import streamlit as st
from groq import Groq

# 1. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ (ุชุตููู ูุธูู ููุฑูุญ)
st.set_page_config(page_title="AI Pricing Engine", page_icon="๐ฐ", layout="wide")

st.title("๐ ูุญุฑู ุงูุชุณุนูุฑ ุงูุฏููุงูููู ุงูุฐูู (AI Pricing Engine)")
st.markdown("ุฃุฏุฎู ูุนุทูุงุช ููุชุฌู ูุงูุณููุ ูุณูููู **Groq AI** ุจุชุญููููุง ูุฎุจูุฑ ุงูุชุตุงุฏู ููุนุทูู ุงูุณุนุฑ ุงูุฐูุจู.")

# 2. ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (ููููุชุงุญ ูุงูุฎูุงุฑุงุช ุงูุนุงูุฉ)
with st.sidebar:
    st.header("๐ ุฅุนุฏุงุฏุงุช ุงููุธุงู")
    api_key = st.text_input("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", type="password")
    
    st.header("๐ ุจูุฆุฉ ุงูุณูู (Market Env)")
    country = st.selectbox("1. ุงูุฏููุฉ ุงููุณุชูุฏูุฉ", ["ุงููุบุฑุจ (MAD)", "ุงูุณููุฏ (SEK)", "ุฃูุฑููุง (USD)", "ุฃูุฑูุจุง (EUR)"])
    season = st.select_slider("2. ุงูููุณู ุงูุญุงูู", options=["ุฑููุฏ (Off-season)", "ุนุงุฏู (Normal)", "ุฐุฑูุฉ (Peak Season)"])
    brand_power = st.selectbox("3. ููุฉ ุนูุงูุชู ุงูุชุฌุงุฑูุฉ", ["ุนูุงูุฉ ุฌุฏูุฏุฉ/ุบูุฑ ูุนุฑููุฉ", "ูุชูุณุทุฉ", "ุนูุงูุฉ ูุงุฎุฑุฉ (Premium)"])

# 3. ูุงุฌูุฉ ุฅุฏุฎุงู ุงูุจูุงูุงุช (ููุณูุฉ ูุนููุฏูู ูุชูููู ุงูุชุดุชุช)
col1, col2 = st.columns(2)

with col1:
    st.subheader("๐ฆ ุจูุงูุงุช ุงูููุชุฌ (Product Data)")
    product_name = st.text_input("4. ุงุณู ุงูููุชุฌ", "ูุซุงู: ูุงุชู ุขูููู 13 ูุณุชุนูู")
    product_condition = st.selectbox("5. ุญุงูุฉ ุงูููุชุฌ", ["ุฌุฏูุฏ", "ูุฌุฏุฏ (Refurbished)", "ูุณุชุนูู"])
    cost = st.number_input("6. ุชูููุฉ ุงูููุชุฌ ุนููู (Cost)", min_value=0.0, value=1000.0)
    target_margin = st.slider("7. ุฃูู ูุงูุด ุฑุจุญ ุชูุจูู (%)", 5, 100, 20)

with col2:
    st.subheader("๐ ุจูุงูุงุช ุงูููุงูุณุฉ (Competition & Demand)")
    comp_price = st.number_input("8. ูุชูุณุท ุณุนุฑ ุงูููุงูุณูู", min_value=0.0, value=1200.0)
    stock_level = st.number_input("9. ูููุฉ ุงููุฎุฒูู ูุฏูู", min_value=1, value=50)
    demand = st.slider("10. ุญุฌู ุงูุทูุจ ูู ุงูุณูู (%)", 0, 100, 60)

# 4. ุฒุฑ ุงูุชุดุบูู ูุงูุชุญููู
st.markdown("---")
if st.button("๐ง ุงุญุณุจ ุงูุณุนุฑ ุงููุซุงูู ุงูุขู", use_container_width=True):
    if not api_key:
        st.error("โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ููุชุงุญ Groq API ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุฃููุงู.")
    elif cost == 0:
        st.error("โ๏ธ ูุง ูููู ุฃู ุชููู ุงูุชูููุฉ ุตูุฑ.")
    else:
        with st.spinner("ุฌุงุฑู ุชุญููู ุจูุงูุงุช ุงูุณูู ููุถุน ุงุณุชุฑุงุชูุฌูุฉ ุงูุชุณุนูุฑ..."):
            try:
                # ุชููุฆุฉ ุงูุงุชุตุงู ุจู Groq
                client = Groq(api_key=api_key)
                
                # ุจูุงุก ุงูู Prompt ุงูููุฏุณู ุงูุฏููู
                prompt = f"""
                ุฃูุช ุฎุจูุฑ ุงูุชุตุงุฏู ููุณุชุดุงุฑ ุชุณุนูุฑ ููุดุฑูุงุช. ุจูุงุกู ุนูู ุงููุนุทูุงุช ุงูุชุงููุฉุ ุฃุนุทูู "ุงูุณุนุฑ ุงููุซุงูู" ููุฐุง ุงูููุชุฌ.
                
                ุงููุนุทูุงุช:
                1. ุงูุณูู: {country}
                2. ุงูููุณู: {season}
                3. ููุฉ ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ: {brand_power}
                4. ุงูููุชุฌ: {product_name}
                5. ุงูุญุงูุฉ: {product_condition}
                6. ุงูุชูููุฉ: {cost}
                7. ุงูุญุฏ ุงูุฃุฏูู ููุฑุจุญ ุงููุทููุจ: {target_margin}%
                8. ุณุนุฑ ุงูููุงูุณูู: {comp_price}
                9. ุงููุฎุฒูู ุงููุชุงุญ: {stock_level} ูุทุนุฉ
                10. ููุฉ ุงูุทูุจ: {demand}%
                
                ุฃุฌุจ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุจุฃุณููุจ ุนููู ููุจุงุดุฑ. ูุฌุจ ุฃู ูุญุชูู ุฑุฏู ุนูู:
                - **ุงูุณุนุฑ ุงูููุชุฑุญ:** (ุฑูู ูุงุถุญ)
                - **ูุงูุด ุงูุฑุจุญ ุงููุชููุน:** (ุจูุงุกู ุนูู ุงูุณุนุฑ ุงูููุชุฑุญ)
                - **ุงูุงุณุชุฑุงุชูุฌูุฉ ุงููุณุชุฎุฏูุฉ:** (ูุซุงู: ุงุฎุชุฑุงู ุงูุณููุ ุงููุดุทุ ุงููููุฉ...)
                - **ุงูุชุจุฑูุฑ ุงูุงูุชุตุงุฏู:** (ูู 3 ุฃุณุทุฑ ููุงุฐุง ุงุฎุชุฑุช ูุฐุง ุงูุณุนุฑ ูููู ุณูุชููู ุนูู ุงูููุงูุณูู).
                """
                
                # ุฅุฑุณุงู ุงูุทูุจ ูู Llama-3 (ุณุฑูุน ุฌุฏุงู ูุฐูู)
                chat_completion = client.chat.completions.create(
                    messages=[
                        {"role": "system", "content": "You are a highly intelligent pricing engine algorithm."},
                        {"role": "user", "content": prompt}
                    ],
                    model="llama3-70b-8192", 
                    temperature=0.3, # ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ููุฎูุถุฉ ูุถูุงู ุญุณุงุจุงุช ุฏูููุฉ ูููุณุช ุฅุจุฏุงุนูุฉ
                )
                
                # ุนุฑุถ ุงููุชูุฌุฉ
                st.success("โ ุชูุช ุนูููุฉ ุงูุชุญููู ุจูุฌุงุญ!")
                st.markdown("### ๐ก ูุชูุฌุฉ ุงูุชุญููู (AI Recommendation)")
                st.info(chat_completion.choices[0].message.content)
                
            except Exception as e:
                st.error(f"ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุงุชุตุงู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู: {e}")
